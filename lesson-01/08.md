db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $inc: { price: 50 },
    $addToSet: { tags: "premium" },
    $set: { status: "active" },
    $currentDate: { lastUpdated: true }
  }
)



{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}





db.users.updateOne(
  { email: "user@example.com" },
  {
    $set: { "address.city": "Boston" },
    $addToSet: { interests: "photography" },
    $inc: { loginCount: 1 }
  }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}







db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $min: { price: 899 } }
)

  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0





db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $max: { quantity: 100 } }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}







db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  {
    $max: { price: 49.99 },
    $min: { discountPercent: 90 }
  }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}









db.users.updateOne(
  { email: "new.user@example.com" },
  {
    $set: {
      name: { first: "New", last: "User" },
      email: "new.user@example.com",
      status: "active"
    },
    $setOnInsert: {
      createdAt: new Date(),
      role: "customer"
    }
  },
  { upsert: true }
)
{
  acknowledged: true,
  insertedId: ObjectId('68f8a8e49bea836727d11516'),
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 1
}









db.users.updateOne(
  { email: "user@example.com" },
  {
    $set: { lastSeen: new Date() },
    $setOnInsert: { firstSeen: new Date() }
  },
  { upsert: true }
)
{
  acknowledged: true,
  insertedId: ObjectId('68f8a8f09bea836727d11518'),
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 1
}











db.products.bulkWrite([
  {
    updateOne: {
      filter: { sku: "PRODUCT-001" },
      update: { $set: { status: "active" } }
    }
  },
  {
    updateOne: {
      filter: { sku: "PRODUCT-002" },
      update: { $inc: { quantity: 10 } }
    }
  },
  {
    insertOne: {
      document: {
        sku: "PRODUCT-003",
        name: "New Product",
        price: 99.99
      }
    }
  }
])
{
  acknowledged: true,
  insertedCount: 1,
  insertedIds: {
    '2': ObjectId('68f8a8f85b1db5409ff5ca12')
  },
  matchedCount: 0,
  modifiedCount: 0,
  deletedCount: 0,
  upsertedCount: 0,
  upsertedIds: {}
}







db.products.bulkWrite([
  {
    updateOne: {
      filter: { sku: "SKU-001" },
      update: { $set: { name: "Product 1", price: 29.99 } },
      upsert: true
    }
  },
  {
    updateOne: {
      filter: { sku: "SKU-002" },
      update: { $set: { name: "Product 2", price: 39.99 } },
      upsert: true
    }
  }
])
{
  acknowledged: true,
  insertedCount: 0,
  insertedIds: {},
  matchedCount: 0,
  modifiedCount: 0,
  deletedCount: 0,
  upsertedCount: 2,
  upsertedIds: {
    '0': ObjectId('68f8a9149bea836727d1151c'),
    '1': ObjectId('68f8a9149bea836727d1151d')
  }
}




db.counters.findAndModify({
  query: { _id: "orderNumber" },
  update: { $inc: { sequence: 1 } },
  new: true,
  upsert: true
})
{
  _id: 'orderNumber',
  sequence: 2
}




db.products.updateOne(
  {
    sku: "LAPTOP-DELL-XPS13",
    quantity: { $gte: 5 }
  },
  {
    $inc: { quantity: -5 }
  }
)

Error: Insufficient stock


{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}











db.products.updateMany(
  {},
  [
    {
      $set: {
        status: {
          $cond: {
            if: { $gt: ["$quantity", 0] },
            then: "in-stock",
            else: "out-of-stock"
          }
        }
      }
    }
  ]
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 10,
  modifiedCount: 10,
  upsertedCount: 0
}


const user = db.users.findOne({
  email: "user@example.com",
  "cart.productId": productId
})

if (user) {
  db.users.updateOne(
    { email: "user@example.com", "cart.productId": esmempio },
    { $inc: { "cart.$.quantity": 1 } }
  )
} else {
  db.users.updateOne(
    { email: "user@example.com" },
    {
      $push: {
        cart: {
          productId: esempio,
          quantity: 1,
          addedAt: new Date()
        }
      }
    }
  )
}









db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $inc: { viewCount: 1 },
    $set: { lastViewed: new Date() },
    $setOnInsert: { firstViewed: new Date() }
  },
  { upsert: true }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}






db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $inc: { viewCount: 1 },
    $set: { lastViewed: new Date() },
    $setOnInsert: { firstViewed: new Date() }
  },
  { upsert: true }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}



db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  {
    $inc: { "rating.count": 1, "rating.total": 5 }
  }
)

const product = db.products.findOne({ sku: "LAPTOP-DELL-XPS13" })
const average = product.rating.total / product.rating.count

db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  { $set: { "rating.average": average } }
)
TypeError: Cannot read properties of null (reading 'rating')








db.users.updateOne(
  { email: "user@example.com" },
  {
    $set: {
      status: "deleted",
      deletedAt: new Date(),
      deletedBy: emsempio id admin
    }
  }
)




db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  {
    $set: {
      name: "Updated Name",
      price: 1399.99
    },
    $inc: { __v: 1 },
    $currentDate: { updatedAt: true }
  }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}




const user = db.users.findOne({
  email: "user@example.com",
  role: "admin"
})

if (!user) {
  throw new Error("Unauthorized")
}

db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  { $set: { status: "active" } }
)
Error: Unauthorized




db.products.updateMany(
  { _id: { $in: esempioidprodotto } },
  { $set: { status: "active" } }
)




db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  { $set: { status: "active" } }
)
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}